# Решение тестового задания (9 неделя)
## Постановка задачи
Задание на битриксе:  
В компании предусмотрена возможность выбора служебного автомобиля для служебной поездки на определенное время из не занятых другими сотрудниками. В служебной части корпоративного сайта необходимо будет размещать актуальную информацию о доступных для конкретного сотрудника автомобилях на запланированное время поездки.   
Дополнительные условия:
- каждая модель автомобиля имеет определенную категорию комфорта (первая, вторая, третья... );
- для определенной должности сотрудников доступны только автомобили определенной категории комфорта (одной или нескольких категорий);
- за каждым автомобилем закреплён свой водитель.
Необходимо:
1. Спроектировать структуру административного раздела управления контентом (инфоблоки/хайлоадблоки, их свойства и связи), составить в любом редакторе (с возможностью экспорта в  jpg, png, pdf или просмотра в браузере) диаграмму связей. Например https://www.drawio.com/;
2. Написать компонент, который выводит для текущего сотрудника список свободных автомобилей на запрошенное время (запрошенное время начала и время окончания поездки передается от клиента на сервер в get-параметрах) с указанием модели, категории комфорта, водителя - шаблон c html-разметкой (template.php) делать не нужно.
## Структура административного раздела
Для реализации описанного выше функционала предлагается создать 4 инфоблока: "Должности", "Автомобили", "Поездки" и "Водители". Также необходимо добавить пользовательское поле с кодом **UF_POSITION** объекту **USER**.  
![Структура административного раздела](/structure_scheme/db_image.png)   
Свойствам инфоблоков следует задать следующие типы:
+ Пользователи
    - **UF_POSITION** &ndash; привязка к элементу
+ Должности
    - **CAR_CLASS** &ndash; строка, множественное
+ Поездки
    - **EMPLOYEE** &ndash; привязка к пользователю
    - **CAR** &ndash; привязка к элементу
    - **TIME_FROM** &ndash; дата/время
    - **TIME_TO** &ndash; дата/время
+ Автомобили
    - **REG_ID** &ndash; строка
    - **DRIVER** &ndash; привязка к элементу
    - **CLASS** &ndash; строка
+ Водители
    - **FIRST_NAME** &ndash; строка
    - **LAST_NAME** &ndash; строка
    - **AGE** &ndash; строка
## Создание агента
На сервере необходимо создать агента, который будет запускаться раз в сутки и удалять завершенные поездки.
## Использование компонента
Скопируйте файлы компонента в директорию сайта в папку **/local/components/**.   
Подключить компонент на странице сайта можно, например, следующим способом:
```php
<?php
$APPLICATION->IncludeComponent(
    "trolleyfun:cars.available",
    "",
    [
        "CARS_IBLOCK_CODE" => "cars",
        "ORDERS_IBLOCK_CODE" => "orders",
        "JOBS_IBLOCK_CODE" => "jobs",
        "DRIVERS_IBLOCK_CODE" => "drivers",
        "TIME_FROM_ALIAS" => "from",
        "TIME_TO_ALIAS" => "to"
    ],
    false
);
?>
```
